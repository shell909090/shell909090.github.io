<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Gfw on Shell&#39;s Home</title>
    <link>//blog.shell909090.org/tags/gfw/</link>
    <description>Recent content in Gfw on Shell&#39;s Home</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <copyright>CC-BY-SA4.0</copyright>
    <lastBuildDate>Fri, 04 May 2012 02:09:39 +0800</lastBuildDate>
    <atom:link href="//blog.shell909090.org/tags/gfw/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>关于翻墙服务几句</title>
      <link>//blog.shell909090.org/blog/archives/2162/</link>
      <pubDate>Fri, 04 May 2012 02:09:39 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/2162/</guid>
      <description>&lt;p&gt;目前有很多服务，其实我们都是按照非正规用法在用的。例如github，看上去像是个源码托管服务，我们拿来当blog用。GAE，看上去像是个代码托管服务，我们当翻墙工具用。空间，常规都是发布应用的，我们也拿来翻墙。&lt;/p&gt;&#xA;&lt;p&gt;对服务的非正规用法，我们首先把这个命题分几个类。一类是服务本身没有对用法做出特殊假定，但是你的用法和传统用法相违背，例如VPS传统是作为私有主机用的，用于发布网站。但是天朝人民经常用VPS当作云存储，或者是VPN。作为这类用途，我觉得是没有任何问题的，服务商本身就没有限定你的应用类型。&lt;/p&gt;&#xA;&lt;p&gt;第二类，是服务商默许或者半鼓励你作为特殊用途应用。例如github并不反对你用他作为blog。这也没问题。&lt;/p&gt;&#xA;&lt;p&gt;第三类，服务商明确反对的用途。例如利用空间来翻墙。一来ssh流量并不计入你的流量限额中，二来长期使用空间翻墙会导致空间的服务器地址在中国被封。前者影响成本，后者影响销售。因此，很多空间商都封锁了ssh的跳板功能，例如DreamHost。&lt;/p&gt;&#xA;&lt;p&gt;也许有人会骂，空间商为什么要阻止ssh，这是对自由人权的破坏什么的。我觉得这压根是骂错人了。如果你无法自由浏览你想要浏览的网页，你需要骂的是阻止你访问的人，而不是别人。空间商既没有封你，也不是帮凶。通过对人有害的方法获得自己想要的利益，别人阻止你还骂人，这是流氓嘴脸。&lt;/p&gt;&#xA;&lt;p&gt;第四类，服务商没有明确回应，他们可能对此一无所知。这种情况最复杂，也最值得讨论。&lt;/p&gt;&#xA;&lt;p&gt;无论空间商默许还是反对，我们都可以看作是一个附加合同。这种事情你同意就接着用，不同意就换家人，市场经济大家好聚好散。但是服务商没有明确回应，那么事情就比较暧昧。我倾向于将事情分为两个阶段，或者类型。一类是影响较小，或者刚刚出现，服务商有理由不知道。这种阶段下，该怎么用就怎么用。直到服务商有表态为止。另一类是我们有理由相信服务商知道这类用法。在这种阶段下，你不妨参照第二类。&lt;/p&gt;&#xA;&lt;p&gt;当然，这里顺便说另外一个话题，就是很多人对翻墙的要求是——免费。&lt;/p&gt;&#xA;&lt;p&gt;我去阿，你在中国网络上玩多了，啥都要免费，有没有写信给电信要求宽带接入免费阿。你要是真没钱，要么就不用，要么就学学怎么让自己出去。&lt;/p&gt;&#xA;&lt;p&gt;天下的特权有几类的，一种是你通过努力来获得某种特权，一种是你付钱让别人帮你获得这种特权，一种是左求右拜，借到某种特权。这特权还不稳固，有点问题就让人收了回去，因此不得不小心翼翼，缩着尾巴做人。且不提现实中有个头痛脑热，行政手续，求爷爷告奶奶的诸多无奈。那毕竟很多时候还是不得以而为之。网络上凡是有点大小P事，全是“360度冰天雪地裸体跪求”，就这种人还自诩为“不食嗟来之食”之后，实在让人叹息。&lt;/p&gt;&#xA;&lt;p&gt;墙的存在意义，就是要“拦截大多数”。要稳定翻墙，基本就两种途径。一者是牛，自己付出辛苦，学会了整个过程，从而翻墙出去。或者你付钱，弄到了翻墙帐号，从而翻墙出去，这也是一种。这两者都算的上少数，剩下的就是绝对的大多数。既不付钱，也不想付出辛苦，张口就求各种方法的人不知有没有想过，当某种方法会的人多了，墙自然就会把这种方法连根铲掉。法子不能用了，瞬间破口大骂给法子的人，不知道脑子里转的是什么逻辑——或者是，他们其实想过，只是：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;在中国，只要考虑三天后的事情，三个月后的事情谁说的准呢。&lt;/li&gt;&#xA;&lt;li&gt;在网络上求爷爷告奶奶也是一种辛苦阿。&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;——我已经连叹息都发不出了。&lt;/p&gt;&#xA;&lt;p&gt;最后一个话题，如果你的某种对服务的应用，对其他人会产生伤害怎么办？例如，你用某个空间翻墙，这个空间IP就可能被墙。你用GAE翻墙，GAE就会被墙。你在网站上发表很合理的言论，自己没事，站长进去了。&lt;/p&gt;&#xA;&lt;p&gt;首先请允许我就最后一个例子向中国的有关部门表示无比的XXX。。。就这精确度还好意思指责人家老美的导弹？&lt;/p&gt;&#xA;&lt;p&gt;我们先说最后一个。很多人往往鄙视中国的网站管理者，我写个无比正常的内容你都给我删了。实际上，在一切不正常都当作正常的国度，再正常的内容都可能是不正常的。我是挺同情网站的管理者的，删把，道义上挺站不住的，不删吧，自己进去了。某种意义上说，开网站是为了赚两个钱顺便提供娱乐的(当然，很多人是反过来的)，而不是为你表达言论挺身而出的——真是这个目的开的网站现在站长的骨头都在长草了——从这个意义看，删，不是恶。如果你要指责，应当指责的是这个制度和产生这个制度的原因。&lt;/p&gt;&#xA;&lt;p&gt;但是，我又要但是了，这也有个度。删本身不是恶，但是捕风捉影，删了不说，不删，偷偷让别人看不到，这就沦为不道德了。只是在中国，各种事情交错纠缠之下，人人皆提心吊胆提防别人，往往事情就会走了样。&lt;/p&gt;&#xA;&lt;p&gt;这里插一个前两天的段子。魔都地铁是要安检的，大家知道。坐地铁的经常听说保安和你争执两句就躺地上装死讹钱的例子。前两天过地铁的时候，把包拿给保安检查。保安摸到我的饭盒，说，这是啥阿。我刚要说话，旁边保安示意放行，小声说，摸坏了你赔不起。&lt;/p&gt;&#xA;&lt;p&gt;——那地铁安检的结果就不言自明了。&lt;/p&gt;&#xA;&lt;p&gt;因此，在层层把关的网络审查中，往往下层执行的东西和上层想的差了十万八千里。其距离大概就和客户心里的网站和项目经理笔下的网站和工程师手下的代码的区别差不多。&lt;/p&gt;&#xA;&lt;p&gt;当然，即便结论如此，我还是管我自己。我的blog都是在自己的域名下面——结果被封，也是自己的选择。如果发到其他网站，能不能留，留多久，就看别人的意思了。&lt;/p&gt;&#xA;&lt;p&gt;至于使用GAE翻墙的问题，我觉得适用于我们有理由相信服务商知道的情况。我相信Google一定知道上面有人放什么网站，做翻墙用途。既然他没有反对，我们可以看作是他默许。&lt;/p&gt;</description>
    </item>
    <item>
      <title>2012年4月12日断网的技术记录</title>
      <link>//blog.shell909090.org/blog/archives/2142/</link>
      <pubDate>Mon, 16 Apr 2012 02:24:40 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/2142/</guid>
      <description>&lt;p&gt;4月12日上午, 大约北京时间10点(UTC02:00前后),&lt;/p&gt;&#xA;&lt;p&gt;中国大部分地区发生了一次断网. 这次断网我有幸正好在使用网络, 因此跟踪调试了整个过程.&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;网络开始中断&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;当时我在公司里面用ssh调整一台国外的机器, 同时用另一台机器作为ssh跳板访问google. 问题发生的时候, 很多国外网站都无法打开, ssh指令不能工作. 我的第一反应就是, GFW针对ssh做了拦截.&lt;/p&gt;&#xA;&lt;p&gt;鉴于其他可能, 我登录回了家中, 从家里的机器直接ssh到国外的跳板, 一切正常. 莫非只是我这里的ssh发生了断路? 我正在这么猜测的时候, 家里的ssh也随即断开. 我kill了当前进程, 重新连接后, 恢复了对家里服务器的控制, 但是境外的ssh跳板已经不能连接.&lt;/p&gt;&#xA;&lt;p&gt;至此, 可以确定中国出国网络逐步发生中断, 针对什么协议, 机制如何尚不清楚.&lt;/p&gt;&#xA;&lt;p&gt;但是, 我同时用同一台机器打开了openvpn, openvpn会提供一个内网接口.&lt;/p&gt;&#xA;&lt;p&gt;我偶然的用这个内网iface访问了一下, 一切正常. 再尝试了一下, openvpn上网正常. 这说明问题可能局限在ssh上.&lt;/p&gt;&#xA;&lt;ol start=&#34;2&#34;&gt;&#xA;&lt;li&gt;这不是一个个例, 这是大规模断网&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;既然我对境外服务器还有控制能力, 我就更换了一个ssh端口, 但是问题并没有解决. 这似乎说明封锁不是针对端口(port), 而是针对协议(protocol)的. 为了确证这点, 我对通讯过程做了抓包, 但是结果出乎我的意料. 问题并不出现在ssh握手的时候, 而是tcp第二步的syn-ack回包彻底消失. 这表明封锁并不针对ssh协议, 而是tcp协议栈!&lt;/p&gt;&#xA;&lt;p&gt;这非常疯狂, 如果是这样的话, 大部分基于tcp的网络协议将无法工作, 包括境外大部分网站的http协议. 我从twitter上看到, 很多人的各种工具都相继失效, 并且境外很多的http(而非https)确实无法访问, 这和我的判断相一致. 这是针对tcp协议栈的大规模拦截.&lt;/p&gt;&#xA;&lt;ol start=&#34;3&#34;&gt;&#xA;&lt;li&gt;为什么特殊&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;通常而言, GFW有三个常见工作模式.&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;dns污染&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;ip封锁&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;深度包过滤(关键字拦截)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;其中dns封锁只对域名有效, ip封锁只对ip有效, 只有深度包过滤才是最麻烦的.&lt;/p&gt;&#xA;&lt;p&gt;但是通常深度包过滤是使用旁路过滤的方式, 在连接出现问题时发出rst包干扰tcp工作. 而本次的模式是将境外向境内的tcp包直接丢弃, 而非rst. 这是ip封锁的模式.&lt;/p&gt;</description>
    </item>
    <item>
      <title>组合翻墙方法——细节</title>
      <link>//blog.shell909090.org/blog/archives/1804/</link>
      <pubDate>Wed, 18 May 2011 09:53:48 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/1804/</guid>
      <description>&lt;p&gt;中国这网络，越来越没法上了。现在你访问国外禁网，就会中断连接10分钟。问题是我也不知道哪个网是禁止的&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;现在教大家一招，基本能够永久套上翻墙。理论上你就没有中招的可能，尤其适用于公司使用。&lt;/p&gt;&#xA;&lt;p&gt;首先是squid，这个是流量分离和缓存的关键部件。你可以用pac替代，但是这只局限于某台具体的机器，并且代理用户支持pac。squid的好处是，任何http访问都可以分流，而且无须客户端支持。甚至如果你精通squid配置，你可以配置成透明代理（cache拦截），从而避免在每台机器上修改代理配置。当然，cache拦截是有技术问题的，具体请参考这篇（&lt;a href=&#34;http://home.arcor.de/pangj/squid/chap09.html#a6&#34;&gt;http://home.arcor.de/pangj/squid/chap09.html#a6&lt;/a&gt;）。&lt;/p&gt;&#xA;&lt;p&gt;squid的配置如下：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;include /etc/squid3/gfw.conf&#xA;acl localnet src [192.168.0.0/16](http://192.168.0.0/16)&#xA;http\_access allow localnet&#xA;http\_access allow localhost&#xA;cache\_peer 127.0.0.1 parent 8123 0 no-delay no-query&#xA;cache\_peer\_access 127.0.0.1 allow gfw&#xA;always\_direct deny gfw&#xA;never\_direct allow gfw&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;以上配置是允许192.168.0.0的C类内部子网访问本机，所有gfw规则的域名必须通过8123端口的上层代理，而其他的直接访问。注意以上不是完整配置，不保证可以独立运行，只保证在debian的标准配置文件的基础上，修改以上内容就可以工作。独立配置你可能还需要加入以下两句。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;http\_access deny all&#xA;http\_port 3128&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;配置中的gfw.conf是gfw这个规则的定义文件，这个文件是由程序生成的，程序如下。注意，你系统上的python版本应当在2.5以上。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#!/usr/bin/python&#xA;from \_\_future\_\_ import with\_statement&#xA;with open(&#39;gfw&#39;, &#39;r&#39;) as fi:&#xA;&#x9;for line in fi: print &#39;acl gfw dstdomain .%s&#39; % line.strip()&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;以上内容，保存为平文本，赋予执行权限后，直接执行即可。同目录下必须有一个gfw文件，平文本，里面一行保存一个域名。域名不以.开头，可以使用泛域名（例如&lt;a href=&#34;http://google.com&#34;&gt;google.com&lt;/a&gt;匹配&lt;a href=&#34;http://www.google.com&#34;&gt;www.google.com&lt;/a&gt;）。执行后打印出内容，所以你还需要重定向。&lt;code&gt;./gfw2squid &amp;gt; /etc/squid3/gfw.conf&lt;/code&gt;。当每次gfw文件升级时，你都需要重新生成，并且迫使squid加载。方法是&lt;code&gt;squid -k reconfigure&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;OK，现在你有一台配置了分流的squid，然后你需要一个可以翻墙的代理。由于我的目标是看youtube，所以我采取了一个非常复杂而高性能高可靠的方案。&lt;/p&gt;</description>
    </item>
    <item>
      <title>gfw升级了？</title>
      <link>//blog.shell909090.org/blog/archives/1704/</link>
      <pubDate>Wed, 23 Feb 2011 10:14:00 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/1704/</guid>
      <description>&lt;p&gt;今天使用的主机上有个朋友发来消息，api用不了了。贝壳检查了一下，主机正常阿。&lt;/p&gt;&#xA;&lt;p&gt;最终，发现问题是这样的。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;shell@shell-deb:\~/tmp\$ wget &amp;lt;http://shell909090.org/apis/&amp;gt;&#xA;--2011-02-23 10:08:39--  &amp;lt;http://shell909090.org/apis/&amp;gt;&#xA;正在解析主机 shell909090.org... 74.86.182.175&#xA;正在连接 [shell909090.org](http://shell909090.org)|74.86.182.175|:80...&#xA;已连接。&#xA;已发出 HTTP 请求，正在等待回应... 读取文件头错误 (Connection reset by peer)。&#xA;重试中。&#xA;&#xA;--2011-02-23 10:08:41--  (尝试次数： 2)  &amp;lt;http://shell909090.org/apis/&amp;gt;&#xA;正在连接 [shell909090.org](http://shell909090.org)|74.86.182.175|:80...&#xA;^C&#xA;&#xA;shell@shell-deb:\~/tmp\$ wget &amp;lt;http://shell909090.org/&amp;gt;&#xA;--2011-02-23 10:13:36--  &amp;lt;http://shell909090.org/&amp;gt;&#xA;正在解析主机 shell909090.org... 74.86.182.175&#xA;正在连接 [shell909090.org](http://shell909090.org)|74.86.182.175|:80...&#xA;已连接。&#xA;&#xA;已发出 HTTP 请求，正在等待回应... 200 OK&#xA;长度：1156 (1.1K) \[text/html\]&#xA;正在保存至: “index.html”&#xA;100%\[======================================&amp;amp;gt;\] 1,156       --.-K/s&#xA;花时 0s&#xA;2011-02-23 10:13:37 (277 MB/s) - 已保存 “index.html” \[1156/1156\])&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>CNNIC的证书</title>
      <link>//blog.shell909090.org/blog/archives/91/</link>
      <pubDate>Wed, 03 Feb 2010 11:41:00 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/91/</guid>
      <description>&lt;p&gt;最近，技术圈里面在争论CNNIC的证书被加入到信任根证书里面的问题。本文章试图和专业人士探讨这一变化的过程，以及向非专业人士说明会造成的影响。所有段落前会标明针对的群体。&lt;/p&gt;&#xA;&lt;p&gt;事情的起源，是有人发现CNNIC的证书被加入了Mozilla和系统的信任根证书链里。这引发了大家对早年CNNIC所做的流氓软件的回忆，因此大量技术人士强烈反对。所做的反应包括发起BUG讨论提请Mozilla删除CNNIC的证书，发起投票，写信给Entrust阐述问题等。下面会简述一下信任根证书链，还有CNNIC的背景和历史。&lt;/p&gt;&#xA;&lt;p&gt;本段适合非专业人士阅读。我们在访问一个网页的时候，通常有两种常见的通讯方式。http和https。区别在于，https会使用网站证书加密通讯过程。证书加密包含了几重的意义，首先，证书保证了你们的通讯没有第三者能截获。其次，证书验证了你访问的网站，是否是他号称的那个网站。也许很多人无法理解，这两种攻击怎么可能发生。要理解一点，中国电信也不是铁板一块，你完全无法指望他们的员工也绝对安全。否则的话，为什么所有银行都使用https来加密访问过程呢？&lt;/p&gt;&#xA;&lt;p&gt;本段适合专业人士阅读。那么，不使用证书会发生如何的攻击呢？一旦有某个人更改DNS(这东西让百度都吃了亏)，以某个服务器替换了你的银行(或者gmail)。那么，你访问你的目标域名的时候，就会被定位到他的中间机器上，他再使用代理技术，通过ssl访问目标服务器。整个过程如同走代理一样，唯一的问题就是你的密码泄露了。那么证书是如何防御这个攻击的呢？如果你访问目标机器，目标机器会让你验证一份证书，标明他的域名(用于防止域名劫持的)，签署者。一旦域名不符合，或者你不信任证书，就会报警。那么攻击者如何复制这个证书呢？首先他无法通过访问的方式获得证书原文，因为证书给你的其实只有公钥部分。其次他无法将这个过程也代理下来，因为如果这么做，下面的内容就全是不可解的了，那他就纯粹花钱把自己弄成代理服务器了。最后，他也无法生成，因为按照规定，只有域名的拥有者可以向特定的单位申请证书。于是，他无法复制证书，攻击就会失败。&lt;/p&gt;&#xA;&lt;p&gt;本段适合非专业人士阅读。然而，你需要信任什么证书呢？如果你要一家一家的信任证书，会发生什么？你见到是否信任就会习惯的去点，这对安全于事无补。因此，这里引申出一个证书链的问题。通常系统内内置了一些证书，这些证书叫做信任根证书。这些证书的权限是，可以让你信任其他证书。而被他们授权的证书，则分为可以继续授权和不可以继续授权两种。一旦被他们签署授权的证书，最起码你访问的时候不会有警告了。现在，CNNIC加入了这个根证书链。那CNNIC是个什么公司呢？他自称是中国科学院下属的中国互联网络信息中心，服务于科学和研究的机构，但很多人指出CNNIC的直接主管是工信部。当年，CNNIC推出中文域名服务，这项服务需要在几乎所有人的电脑内安装插件。他为了提高安装率，使用了不可删除的保护技术。这导致很多人的电脑安装后，无法卸载程序。至于安装呢？也不全是自愿安装(我不排除自愿者，绿霸还有自愿的呢)。他们曾经利用系统漏洞，向大量电脑上强行安装插件。而且CNNIC还借助官方身份，大量推行中文域名——其实他们根本就不是政府机构，而是非营利机构。并且，在前两年拼命忽悠CN域名，最近又突然停止域名解析(虽然是国家规定的)，道歉赔偿啥都没有。大家自己想，真的可以信任这种公司么？&lt;/p&gt;&#xA;&lt;p&gt;本段适合所有人阅读。现在CNNIC已经进入了信任根证书链，如果配合国家级的DNS劫持技术，理论上可以构造一个假的&lt;a href=&#34;http://mail.google.com&#34;&gt;mail.google.com&lt;/a&gt;，或者&lt;a href=&#34;http://www.hotmail.com&#34;&gt;www.hotmail.com&lt;/a&gt;。走代理，自己给自己签署一个证书。从而获得你的完整会话。这里(&lt;a href=&#34;http://autoproxy.org/zh-CN/node/66)&#34;&gt;http://autoproxy.org/zh-CN/node/66)&lt;/a&gt;有比较大的说明和讨论。&lt;/p&gt;&#xA;&lt;p&gt;我对这个事情的观点是。作为Mozilla或者任何根证书的发行机构，在没有直接证据的情况下，不大可能拒绝一个国家级机构的要求。然而，无论任何原因，信任一个机构，就代表你要为他的行为负责。如果CNNIC做出任何危害用户安全的行为，Moziila，微软，Debian.org会被我作为同罪者考虑和抵制。同时，系统发行的根证书系统，是否要去信任，是我们每个人的问题。如果你觉得CNNIC根本不值得信任，那么你可以删除他的所有证书，以及签署了他的所有证书。目前而言，我删除了CNNIC和Entrust的所有证书。&lt;/p&gt;</description>
    </item>
    <item>
      <title>组合翻墙方案</title>
      <link>//blog.shell909090.org/blog/archives/74/</link>
      <pubDate>Wed, 29 Jul 2009 11:44:00 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/74/</guid>
      <description>&lt;p&gt;1.墙的存在和原理简述 1.1.墙的存在&#xA;在您访问某些网站的时候，经常会发现无法访问。通常来说，这是服务器挂了。但是现在，越来越多正常的服务器出现了无法访问的情况。这些服务器中有一些是因为色情和暴力问题，但是更多则是政治层面的因素，例如google和twitter。对于用户来说，可能不关心政治层面的因素。但是政治自然的关心了你，所以我们需要找一种方法，让我们依然能够使用网络上一些很重要的服务。例如gmail(本文即是在gmail中写成的)。本节中，我将简述国家网络防护工程(简称GFW,&#xA;Great FireWall)的工作原理，并在下一节给出一些比较成熟的翻墙方案。&#xA;1.2.DNS污染 我们通过DNS(Domain Name&#xA;Service)将域名转换为IP地址。通常而言，我们不会怀疑ISP的DNS服务器的可信性。然而在某些地方，DNS服务器被用来欺骗客户端，达到屏蔽的作用。例如，在上海的某些地方，&lt;a href=&#34;http://fanfou.com&#34;&gt;fanfou.com&lt;/a&gt;曾经被指向127.0.0.1。如果机器按照这个地址访问，那么肯定无法获得预想的数据。&#xA;这个方案如果控制不当，可能造成全球性的后果。曾经有报道，伊朗将youtube的域名指向了自己的一台蜜罐(Honeypot)服务器。但是由于配置不良，因此DNS错误被扩散到了伊朗以外，导致全世界的youtube访问都被定向到了这台蜜罐。整个过程造成了youtube6小时以上的服务中断。&#xA;1.3.DNS替换欺骗&#xA;由于DNS污染会被下面2.1节的方法绕过，因此在某些地方针对OpenDNS的数据被进行了替换欺骗。UDP53端口的查询数据包被拦截和替换，其造成的结果就是即使使用了OpenDNS，返回结果和电信服务器的结果仍然一致。&#xA;1.4.IP禁止&#xA;对于某些IP，防护系统直接禁止了该IP的访问。这种手法一般见于早期，由于经常导致误杀和株连，同时对最普通的proxy都无效，因此现在已经不常使用。&#xA;1.5.关键词过滤&#xA;防护工程在中国网络的核心路由器上，都放置了一些探头。具体的方法为配置一个核心路由器的镜像端口，将所有通讯数据全部向端口转发一份。该端口指向一套深度包检测集群。如果数据没有异常，则不对通讯进行干扰。如果数据异常，则发送RST包拦截通讯。同时记录双方IP，拦截其后5分钟内的所有TCP&#xA;SYN包。&#xA;这种方法的优势在于，无论多复杂的网络拓扑结构。只要能够开镜像端口，就可以工作。无论多大的规模和多高的流量，只要能添加服务器，就可以支持。同时由于屏蔽效果好，对普通访问的干扰小，因此目前已经成为最主要的屏蔽方式。&#xA;这种手法无法针对UDP工作，因为UDP不存在链接断开状态。同时如果双方都屏蔽RST包，则连接不会被中断。然而如果双方都屏蔽RST包，会导致一些主动断线在对方那里变成死连接，因此无法通过拦截RST包来防御。同时，按照当前的测试结果，IPv6的包并没有被拦截。相信这是因为核心路由器支持了IPv6，但包检测集群尚未支持IPv6包检测。&#xA;1.6.热点屏蔽&#xA;近来发现一种趋势，当某个链接的热度非常高的时候，通向此链接的访问会被屏蔽。由于是接受到RST包，因此不像是服务器超载。这是当前防护系统的新方向，尚没有更多资料。&#xA;2.翻墙方法简述 2.1.OpenDNS&#xA;DNS污染可以通过修改自己的DNS服务器来屏蔽。以Linux为例，当前你的DNS服务器配置可以在/etc/resolv.conf中查看。你可以将其替换为OpenDNS的DNS服务器，而非电信的服务器。OpenDNS是一家商业公司，通过提供DNS服务来收费(不具体解释商业运作)。一般来说，他们的DNS服务还是比较准确的。&#xA;通过OpenDNS可以防御DNS污染，但是无法防御其余方式，而且会被DNS替换所干扰。因此建议一般作为常规网络配置，而非专门的翻墙方案。&#xA;2.2.hosts&#xA;hosts的目地和OpenDNS一致，但可以防御DNS替换。其原理是通过将正确的DNS结果写入/etc/hosts文件，在绕过网络解析过程。从而避免DNS出错。&#xA;该方式无法防御1.4-1.6的屏蔽。 2.3.proxy和变形&#xA;针对DNS欺骗和IIP屏蔽，我们可以通过指定一个国外的代理来访问。由于DNS解析在代理商进行，因此一般不会被欺骗。由于不直接访问IP，因此IP屏蔽也失效。&#xA;一般而言，该方法无法屏蔽1.5的屏蔽，但是有一些变形产品(例如Firefox的gladder插件)，通过变形URL请求，使用特殊代理的方式对1.5进行了部分绕过。但此种方式不保证100%成功。&#xA;2.4.ssh -D&#xA;ssh是一种安全的远程命令行工具，具有很多端口转发选项。其中有一种动态端口转发选项，在服务器端开启后，使得ssh可以被作为一个socks5代理服务器使用。&#xA;此种方式需要有一个墙外的ssh服务器，一般可以购买墙外的空间，他们会附送一个。此种方式可以绕过全部屏蔽方式，但是由于ssh本身的稳定性，因此经常有掉线的问题。而且有的服务器关闭了动态性转发选项，或者对长期连入的ssh连接进行断线处理。同时，由于很多人接入同一个IP进行翻墙，因此很多网站(例如google)会认为你的访问不可信。&#xA;2.5.tor&#xA;tor是一种分布式代理工具，可以在隐蔽源和目标的情况下访问服务器。该方法可以绕过所有屏蔽方式，但是通常而言，该方法的访问会比较慢。同时也存在访问不可信的问题。&#xA;2.6.gae&#xA;gae是google的个人引擎服务，一般由很多服务器构成，而这些服务器一般位于国外。有人针对这个特点，制作了特殊的python程序，能够将客户的访问转换成特殊的加密包，在服务器上访问目标服务器。因此可以被视为一种特殊的代理协议。该方法可以绕过所有屏蔽方式，但是由于众所周知的原因，gae服务器本身有的时候也会被屏蔽，导致该方法无法工作。而且由于google本身的屏蔽，该方式对于某些网站也是无法访问的。该方式也存在访问不可信的问题。&#xA;2.7.vpn&#xA;vpn是唯一一种能够快速有效，一劳永逸的翻墙方式。使用vpn后，等同于你的机器拉了根线接在国外的网络端口上。因此该方法可以穿越所有屏蔽方式，同时很少有访问不可信的问题。唯一的问题是vpn，尤其是快速的vpn很难得，而且通常很贵。&#xA;3.组合翻墙 3.1.问题&#xA;纵观全部翻墙方式，每种方式都有一定的缺陷。2.1-2.3并不总有效，ssh不稳定，tor慢，gae看运气，vpn又贵。同时，我们还要借助终端的客户端组件(foxyproxy之类)来区分被屏蔽的网站和普通网站(使得普通网站的访问不使用特殊的方式)。&#xA;3.2.目标&#xA;本文试图通过某种方法，同时使用2.4-2.6的一种或多种方法。达到访问透明，使用稳定，速度尽量快，流量尽量小的目标。&#xA;3.3.架构&#xA;我们使用squid和haproxy进行代理调度，达到上述目标。squid是一种老牌的开源代理服务器，其特征是会对代理内容进行缓存，减小访问流量。同时，可以将请求转发到其他代理上。从而会自动检测和管理多种代理服务器。haproxy是一种基于tcp和http的反向代理程序，在此我们需要使用它的TCP代理能力，将多种socks5代理集成为一个。&#xA;基本架构图如下： /       -&amp;gt; tor web brower -&amp;gt; squid -&amp;gt; privoxy&#xA;-&amp;gt; haproxy -&amp;gt; sshtunnel      -&amp;gt; gappproxy 3.4.优势&#xA;相对单层代理，组合方式具有多个优势。&#xA;使用squid分离访问线路，并缓存访问数据。对大规模密集访问，可以有效的减小流量。而且对除Firefox外的浏览器，可以根据其访问范围控制代理线路，进一步减小代理流量。(Firefox可以使用AutoProxy或FoxyProxy)&#xA;使用haproxy反向代理了socks5服务，因此可以并行使用多个sshtunnel的带宽。同时自动检测这些ssh是否可用，保证了访问的连续，同时也非常容易添加和减少代理。&#xA;3.5.劣势&#xA;本方法有一个比较明显的问题，即squid无法直接使用socks5代理，因此需要通过privoxy进行转换和保密。但是此时squid只测试privoxy的存活，而不理会socks5的存活。因此当haproxy的后端全部失效的时候，squid仍旧会认为privoxy有效，进而导致出现privoxy的错误页面。&#xA;同时，由于haproxy只检测ssh端口是否相应。因此当远程服务器几乎不响应代理请求时，haproxy并不会将这一代理移除出列表。从而导致某些请求需要非常长的时间完成。&#xA;3.6.适用范围&#xA;本方式在完成设置后，可以稳定，快速，小流量的访问所有网站。客户端无需过多的设置。但是服务设置过于复杂，系统庞大，多数时候还需要一台专门的Linux。相对而言，这种方法更适合于3-5人以上，同时需要翻墙的情况。通过一台专门的虚拟服务器作为代理，可以顺利的让多人同时使用国际网络。&#xA;4.一个实现 4.1.基本系统 debian stable，aptitude install squid3&#xA;squid3-cgi lighttpd tor privoxy haproxy。 4.2.gappproxy&#xA;针对gappproxy项目，请自行去其主页上查看服务器组建方式。作为本次成果之一，贝壳封装了一个gappproxy的deb包。修改了部分源码，并形成了服务。需要的用户可以下载gappproxy-1.0.0beta_all.deb包，安装并修改配置文件即可直接使用。&#xA;4.3.sshtunnel的封装 一般而言，我们使用ssh&#xA;-D来开启sshtunnel。但是这样做有几个缺陷。首先是tunnel无法跟随系统启动，其次是由于tty关闭后程序一同关闭，因此往往需要screen或nohug来保持连接，最后是ssh往往容易意外关闭，导致需要手工重启。&#xA;贝壳针对这种情况，包装了一套脚本，并形成sshtunnel_1.0.0beta_all.deb包。需要的用户可以下载并修改配置。服务启动后即一直运行，关闭后会自动重启。&#xA;5.远景目标&#xA;上述系统安装的细节并未详述，同时，对于新手也太过复杂。因此，考虑实现一套完整的最小虚拟机，提供完整的上述功能。并且给出一套界面，使得用户可以方便的配置和操作整个代理系统。&lt;/p&gt;</description>
    </item>
    <item>
      <title>ssh翻墙服务</title>
      <link>//blog.shell909090.org/blog/archives/71/</link>
      <pubDate>Tue, 07 Jul 2009 22:48:00 +0800</pubDate>
      <guid>//blog.shell909090.org/blog/archives/71/</guid>
      <description>&lt;p&gt;不多说了，上脚本。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;-----------/etc/init.d/sshtunnel------------&#xA;&#xA;#!/bin/bash&#xA;&#xA;PATH=/bin:/sbin:/usr/bin:/usr/sbin&#xA;CONF=&amp;quot;/etc/default/sshtunnel&amp;quot;&#xA;source $CONF&#xA;&#xA;if ! [ -x /usr/bin/ssh ]; then&#xA;exit 0&#xA;fi&#xA;&#xA;start ()&#xA;{&#xA;&#x9;echo -n &amp;quot;Starting tunnel..&amp;quot;&#xA;&#x9;ssh -CNq -D &amp;quot;$PROXYPORT&amp;quot; &amp;quot;$USERNAME@$SSHHOST&amp;quot; -p $SSHPORT -o ServerAliveInterval=30 &amp;amp;&#xA;&#x9;echo &amp;quot;done.&amp;quot;&#xA;}&#xA;&#xA;stop ()&#xA;{&#xA;&#x9;echo -n &amp;quot;Stopping tunnel..&amp;quot;&#xA;&#x9;PID=$(netstat -nlp -4 | grep &amp;quot;:$PROXYPORT&amp;quot;)&#xA;&#x9;PID=$(echo $PID | sed &amp;quot;s/.*LISTENs*(.*)/1/&amp;quot; | cut -f1 -d/)&#xA;&#x9;kill -9 $PID&#xA;&#x9;echo &amp;quot;done.&amp;quot;&#xA;}&#xA;&#xA;case &amp;quot;$1&amp;quot; in&#xA;&#x9;start|restart)&#xA;&#x9;&#x9;start&#xA;&#x9;&#x9;;;&#xA;&#x9;stop)&#xA;&#x9;&#x9;stop&#xA;&#x9;&#x9;;;&#xA;&#x9;restart)&#xA;&#x9;&#x9;stop&#xA;&#x9;&#x9;start&#xA;&#x9;&#x9;;;&#xA;&#x9;*)&#xA;&#x9;&#x9;echo &amp;quot;Usage: $0 {start|stop|restart|clear}&amp;quot;&#xA;&#x9;&#x9;exit 1&#xA;&#x9;&#x9;;;&#xA;esac&#xA;exit 0&#xA;&#xA;-----------------end of file------------------&#xA;&#xA;&#xA;---------/etc/default/sshtunnel----------&#xA;PROXYPORT=7777&#xA;USERNAME=abc&#xA;SSHHOST=abc&#xA;SSHPORT=22&#xA;-----------------end of file------------------&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;首先准备一个远程服务器，获得域名端口，用户名密码。而后将上述脚本放置于指定位置，修改/etc/default/sshtunnel的值，即完成配置。但是上述脚本并没有解决自动登录问题，因此，请生成一个没有密码的密钥，将公钥导入远程服务器。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
